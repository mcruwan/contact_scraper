<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Contact Scraper</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Header -->
    <header class="py-3 shadow-sm">
        <div class="container-fluid px-4">
            <div class="d-flex align-items-center">
                <i class="bi bi-globe2 text-primary fs-1 me-3"></i>
                <div>
                    <h1 class="mb-0 h2">University Contact Scraper</h1>
                    <p class="text-muted mb-0 small">Extract contact information from university websites</p>
                </div>
            </div>
        </div>
    </header>

    <main class="container-fluid px-4 mt-4">
        <div class="row">
            <!-- Left Panel - Configuration -->
            <div class="col-lg-4 col-xl-3">
                <div class="sticky-top" style="top: 20px;">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="bi bi-gear-fill me-2"></i>Configuration</h5>
                        </div>
                        <div class="card-body">
                            <form id="scraperForm">
                                <!-- URL Input -->
                                <div class="mb-4">
                                    <label for="url" class="form-label fw-bold">
                                        <i class="bi bi-link-45deg"></i> Target URL
                                    </label>
                                    <input 
                                        type="text" 
                                        class="form-control form-control-lg" 
                                        id="url" 
                                        placeholder="https://example.edu" 
                                        required
                                    >
                                    <div class="form-text">Enter the university website URL to scrape</div>
                                </div>

                                <!-- Max Pages -->
                                <div class="mb-4">
                                    <label for="maxPages" class="form-label fw-bold">
                                        <i class="bi bi-file-earmark-text"></i> Max Pages
                                        <span class="badge bg-primary" id="maxPagesValue">20</span>
                                    </label>
                                    <input 
                                        type="range" 
                                        class="form-range" 
                                        id="maxPages" 
                                        min="1" 
                                        max="500" 
                                        value="20"
                                        oninput="document.getElementById('maxPagesValue').textContent = this.value"
                                    >
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">1</small>
                                        <small class="text-muted">500</small>
                                    </div>
                                </div>

                                <!-- Workers -->
                                <div class="mb-4">
                                    <label for="workers" class="form-label fw-bold">
                                        <i class="bi bi-cpu"></i> Concurrent Workers
                                        <span class="badge bg-success" id="workersValue">30</span>
                                    </label>
                                    <input 
                                        type="range" 
                                        class="form-range" 
                                        id="workers" 
                                        min="1" 
                                        max="100" 
                                        value="30"
                                        oninput="document.getElementById('workersValue').textContent = this.value"
                                    >
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">1</small>
                                        <small class="text-muted">100</small>
                                    </div>
                                    <div class="form-text">Number of parallel scraping threads</div>
                                </div>

                                <!-- Deep Crawl Toggle -->
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input 
                                            class="form-check-input" 
                                            type="checkbox" 
                                            id="enableDeepCrawl"
                                            onchange="document.getElementById('deepCrawlSettings').style.display = this.checked ? 'block' : 'none'"
                                        >
                                        <label class="form-check-label fw-bold" for="enableDeepCrawl">
                                            <i class="bi bi-diagram-3"></i> Enable Deep Crawling
                                        </label>
                                    </div>
                                    <div class="form-text">Recursively discover more URLs (uses additional API calls)</div>
                                </div>
                                
                                <!-- AI URL Filter -->
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input 
                                            class="form-check-input" 
                                            type="checkbox" 
                                            id="enableAiUrlFilter"
                                        >
                                        <label class="form-check-label fw-bold" for="enableAiUrlFilter">
                                            <i class="bi bi-cpu"></i> Enable AI URL Prioritization (Smart Filter)
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="bi bi-info-circle"></i> AI analyzes URLs to predict contact pages (saves API calls, costs ~$0.001/50 URLs)
                                    </div>
                                </div>

                                <!-- Deep Crawl Requests (conditional) -->
                                <div id="deepCrawlSettings" style="display: none;">
                                    <div class="mb-4 ms-4">
                                        <label for="deepCrawlRequests" class="form-label">
                                            API Requests for Discovery
                                            <span class="badge bg-warning" id="deepCrawlValue">50</span>
                                        </label>
                                        <input 
                                            type="range" 
                                            class="form-range" 
                                            id="deepCrawlRequests" 
                                            min="10" 
                                            max="200" 
                                            value="50"
                                            oninput="document.getElementById('deepCrawlValue').textContent = this.value"
                                        >
                                        <div class="d-flex justify-content-between">
                                            <small class="text-muted">10</small>
                                            <small class="text-muted">200</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="d-grid gap-2">
                                    <button type="submit" id="startBtn" class="btn btn-primary btn-lg">
                                        <i class="bi bi-play-fill"></i> Start Scraping
                                    </button>
                                    <button type="button" id="stopBtn" class="btn btn-danger btn-lg" style="display: none;">
                                        <i class="bi bi-stop-fill"></i> Stop
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="bi bi-bar-chart-fill me-2"></i>Quick Stats</h6>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-6 mb-3">
                                    <div class="stat-box">
                                        <i class="bi bi-link-45deg fs-3 text-primary"></i>
                                        <h3 class="mb-0" id="statsUrls">0 / 0</h3>
                                        <small class="text-muted">URLs (to Scrape / Discovered)</small>
                                    </div>
                                </div>
                                <div class="col-6 mb-3">
                                    <div class="stat-box">
                                        <i class="bi bi-person-lines-fill fs-3 text-success"></i>
                                        <h3 class="mb-0" id="statsContacts">0</h3>
                                        <small class="text-muted">Contacts Found</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Extraction Stats -->
                    <div class="card shadow-sm mt-3" id="aiStatsCard" style="display: none;">
                        <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <h6 class="mb-0"><i class="bi bi-robot me-2"></i>AI Stats</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-2">
                                <small class="text-muted d-block">Model:</small>
                                <strong id="aiModel">-</strong>
                            </div>
                            
                            <!-- Contact Extraction Stats -->
                            <div class="border-bottom pb-2 mb-2">
                                <small class="text-muted fw-bold">Contact Extraction</small>
                                <div class="row text-center mt-2">
                                    <div class="col-6 mb-2">
                                        <div class="stat-box-sm">
                                            <i class="bi bi-lightning-charge-fill text-warning"></i>
                                            <h6 class="mb-0" id="aiCalls">0</h6>
                                            <small class="text-muted">AI Calls</small>
                                        </div>
                                    </div>
                                    <div class="col-6 mb-2">
                                        <div class="stat-box-sm">
                                            <i class="bi bi-check-circle-fill text-success"></i>
                                            <h6 class="mb-0" id="aiSuccessRate">0%</h6>
                                            <small class="text-muted">Success Rate</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- URL Analysis Stats -->
                            <div class="border-bottom pb-2 mb-2" id="urlAnalysisSection" style="display: none;">
                                <small class="text-muted fw-bold">URL Prioritization</small>
                                <div class="row text-center mt-2">
                                    <div class="col-6 mb-2">
                                        <div class="stat-box-sm">
                                            <i class="bi bi-funnel-fill text-info"></i>
                                            <h6 class="mb-0" id="urlAnalysisCalls">0</h6>
                                            <small class="text-muted">Requests</small>
                                        </div>
                                    </div>
                                    <div class="col-6 mb-2">
                                        <div class="stat-box-sm">
                                            <i class="bi bi-coin text-primary"></i>
                                            <h6 class="mb-0" id="urlAnalysisTokens">0</h6>
                                            <small class="text-muted">Tokens</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Total Cost -->
                            <div class="mt-2">
                                <div class="alert alert-info mb-0 py-2">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <i class="bi bi-coin me-1"></i>
                                            <small><strong>Total Tokens:</strong> <span id="aiTokens">0</span></small>
                                        </div>
                                        <div>
                                            <i class="bi bi-currency-dollar me-1"></i>
                                            <small><strong>Total Cost:</strong> $<span id="aiCost">0.000</span></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            <!-- Right Panel - Progress & Results -->
            <div class="col-lg-8 col-xl-9">
                <!-- Progress Section -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0"><i class="bi bi-activity me-2"></i>Progress</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span id="statusText" class="text-muted">Ready to start</span>
                                <span id="progressPercent">0%</span>
                            </div>
                            <div class="progress" style="height: 25px;">
                                <div 
                                    id="progressBar" 
                                    class="progress-bar progress-bar-striped progress-bar-animated" 
                                    role="progressbar" 
                                    style="width: 0%"
                                    aria-valuenow="0" 
                                    aria-valuemin="0" 
                                    aria-valuemax="100"
                                ></div>
                            </div>
                        </div>
                        
                        <div class="alert alert-light border" id="currentUrlBox" style="display: none;">
                            <small class="text-muted d-block mb-1">Currently processing:</small>
                            <code id="currentUrl" class="d-block text-truncate"></code>
                        </div>

                        <!-- Live Activity Feed -->
                        <div class="card border-0 shadow-sm mb-3" id="activityFeed" style="display: none;">
                            <div class="card-header bg-info text-white py-1 px-2">
                                <small class="fw-bold">
                                    <i class="bi bi-activity me-1"></i> Live Activity Feed
                                </small>
                            </div>
                            <div class="card-body p-0" style="max-height: 120px; overflow-y: auto;">
                                <ul class="list-group list-group-flush" id="activityList">
                                    <!-- Activity items will be added here -->
                                </ul>
                            </div>
                        </div>

                        <!-- Detailed Stats - Compact Single Line -->
                        <div class="card border-0 shadow-sm mb-3" id="detailedStats" style="display: none;">
                            <div class="card-body py-2 px-3">
                                <div class="row text-center g-0">
                                    <div class="col-3">
                                        <div class="border-end">
                                            <small class="text-muted d-block mb-1">Pages Scraped</small>
                                            <strong id="pagesScraped" class="text-primary">0 / 0</strong>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="border-end">
                                            <small class="text-muted d-block mb-1">Emails Found</small>
                                            <strong id="emailsFound" class="text-success">0</strong>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="border-end">
                                            <small class="text-muted d-block mb-1">Elapsed Time</small>
                                            <strong id="elapsedTime" class="text-info">00:00</strong>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <small class="text-muted d-block mb-1">Avg Speed</small>
                                        <strong id="avgSpeed" class="text-warning">0/s</strong>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-danger" id="errorBox" style="display: none;">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            <span id="errorText"></span>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-table me-2"></i>Results</h5>
                        <div id="downloadButtons" style="display: none;">
                            <button class="btn btn-sm btn-light me-2" onclick="downloadFile('csv')">
                                <i class="bi bi-file-earmark-spreadsheet"></i> CSV
                            </button>
                            <button class="btn btn-sm btn-light" onclick="downloadFile('json')">
                                <i class="bi bi-file-earmark-code"></i> JSON
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="resultsPlaceholder" class="text-center py-5">
                            <i class="bi bi-inbox fs-1 text-muted"></i>
                            <p class="text-muted mt-3">No results yet. Start scraping to see contacts here.</p>
                        </div>
                        
                        <div id="resultsContainer" style="display: none;">
                            <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark sticky-top">
                                        <tr>
                                            <th style="width: 50px;">#</th>
                                            <th style="width: 20%;">Name</th>
                                            <th style="width: 25%;">Designation</th>
                                            <th style="width: 20%;">Email</th>
                                            <th style="width: 15%;">Phone</th>
                                            <th style="width: 15%;">University</th>
                                            <th style="width: 60px;" class="text-center">Source</th>
                                        </tr>
                                    </thead>
                                    <tbody id="resultsTableBody">
                                        <!-- Results will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>

